% !TEX root = XRayMicroTomography.Presentation.tex

\title{X-ray microtomography}
\author{David Haberthür}
\date{December 22, 2023 | \href{https://ilias.unibe.ch/goto_ilias3_unibe_sess_2774509.html}{9256-HS2023-0: Advanced Microscopy}}

\usetheme{UniBern}

%\includeonlyframes{current}
%then....
%\begin{frame}[label=current]
%\end{frame}

% Some often used abbreviations/commands
\newcommand{\everyframe}{333}% use only every nth frame for the animations
\newcommand{\imageheight}{\linewidth}% set global image width
\newcommand{\imagewidth}{0.618\paperheight}% set global image height
\newlength\imagescale% needed for scalebars
\newcommand{\uct}{{\textmu}CT\xspace}% make our life easier
\newcommand{\eg}{e.\,g.\xspace}%
\newcommand{\ie}{i.\,e.\xspace}%

\usepackage[backend=biber,
	style=numeric,
	url=false,
	isbn=true,
	maxnames=1,
	sorting=none]{biblatex}
\addbibresource{../../../Documents/library.bib} % FastSSD, Windows or Mac works (on Linux/FastSSD we generated a 'Document' folder at the correct level and `ln -s ~/P/Documents/library.bib .` to it)
\usepackage{standalone}
\usepackage{tikz}
	\usetikzlibrary{shadows,spy,mindmap}
	\tikzset{shadowed/.style={preaction={transform canvas={shift={(1pt,-1pt)}},draw=ubRed}}}
\usepackage{pgf-pie}
\usepackage{shadowtext}
	\shadowoffset{1pt}
	\shadowcolor{ubRed}
\usepackage{pgfplots}
	\pgfplotsset{compat=newest}
\usepackage{microtype}
\usepackage[detect-all=true,
	range-phrase=--,
	range-units=single,
	binary-units=true,
	per-mode=symbol,
	per-symbol=/]{siunitx}
\usepackage[absolute,overlay]{textpos}
\usepackage{gitinfo2}
\usepackage{xspace}
\usepackage{ccicons}
\usepackage[version=4]{mhchem}
\usepackage{animate}
\usepackage{fontawesome5}
\usepackage{csquotes}
\usepackage{listings}
	\lstset{basicstyle=\tiny\ttfamily}
	% highlight a line in listings: https://tex.stackexchange.com/a/58543/828
	% Including a crude workaround for recent versions of `listings`: https://tex.stackexchange.com/a/451538/828
	\makeatletter
	\let\old@lstKV@SwitchCases\lstKV@SwitchCases
	\def\lstKV@SwitchCases#1#2#3{}
	\makeatother
	\usepackage{lstlinebgrd}
	\makeatletter
	\let\lstKV@SwitchCases\old@lstKV@SwitchCases
	\lst@Key{numbers}{none}{%
		\def\lst@PlaceNumber{\lst@linebgrd}%
		\lstKV@SwitchCases{#1}%
		{none:\\%
		left:\def\lst@PlaceNumber{\llap{\normalfont
		\lst@numberstyle{\thelstnumber}\kern\lst@numbersep}\lst@linebgrd}\\%
		right:\def\lst@PlaceNumber{\rlap{\normalfont
			\kern\linewidth \kern\lst@numbersep
			\lst@numberstyle{\thelstnumber}}\lst@linebgrd}%
		}{\PackageError{Listings}{Numbers #1 unknown}\@ehc}}
	\makeatother
	% highlight a line in listings: https://tex.stackexchange.com/a/58543/828
\usepackage{pgfplotstable}
\usepackage{booktabs}
\usepackage{colortbl}
\usepackage{multirow}
\usepackage{lipsum}
\usepackage[showseconds=false,showzone=false]{datetime2}
\usepackage{mathastext}

% Define complementary colors to ubRed, from https://www.sessions.edu/color-calculator/
\definecolor{ubRedComplementary}{HTML}{2EE600}

% change tikz font to slide font
% https://tex.stackexchange.com/a/33329/828
\usepackage[eulergreek]{sansmath}
	\pgfplotsset{tick label style = {font=\sansmath\sffamily},
		every axis label = {font=\sansmath\sffamily},
		legend style = {font=\sansmath\sffamily},
		label style = {font=\sansmath\sffamily}
		}

% Globally thicker lines in with tikz
% https://tex.stackexchange.com/a/206769/828
\tikzset{every picture/.style={thick}}

% Acknowledge images just below them
% Based on https://tex.stackexchange.com/a/282637/828
\newcommand{\source}[2]{%
	% Print out (short) link under image, with small text
	\raisebox{-1.618ex}{%
		\makebox[0pt][r]{%
			\tiny\href{http://#1}{#1} #2%
			}%
		}%
	}%
\newcommand{\sourcecite}[2]{%
	% Cite (an image from) a reference
	\raisebox{-1.618ex}{%
		\makebox[0pt][r]{%
			\tiny From~\cite{#1}, #2%
			}%
		}%
	}%
\newcommand{\sourcelink}[3]{%
	% Make the source command an \href{link}{text}
	\raisebox{-1.618ex}{%
		\makebox[0pt][r]{%
			\tiny\href{http://#1}{#2}, #3%
			}%
		}%
	}%

% Define a custom footer *with* progress bar, based on https://tex.stackexchange.com/a/59749/828
\makeatletter
\def\progressbar@progressbar{}% the progress bar
\newcount\progressbar@tmpcounta% auxiliary counter
\newcount\progressbar@tmpcountb% auxiliary counter
\newdimen\progressbar@pbht%progressbar height
\newdimen\progressbar@pbwd%progressbar width
\newdimen\progressbar@rcircle% radius for the circle
\newdimen\progressbar@tmpdim% auxiliary dimension
\progressbar@pbwd=0.618\linewidth%
\progressbar@rcircle=1.5pt%
\def\progressbar@progressbar{%
	\progressbar@tmpcounta=\insertframenumber%
	\progressbar@tmpcountb=\inserttotalframenumber%
	\progressbar@tmpdim=\progressbar@pbwd%
	\multiply\progressbar@tmpdim by \progressbar@tmpcounta%
	\divide\progressbar@tmpdim by \progressbar@tmpcountb%
		\mode<beamer>{%
			\hfill%
			\begin{tikzpicture}%
				\draw[ubGrey] (0,0) -- ++ (\progressbar@pbwd,0);%
				\draw[draw=ubRed,fill=ubGrey] (\the\dimexpr\progressbar@tmpdim-\progressbar@rcircle\relax,.5\progressbar@pbht) circle (\progressbar@rcircle);%
			\end{tikzpicture}%
			\hfill%
			git.io/fjpP7\xspace|\xspace v.\xspace\href{https://github.com/habi/Lecture.Microtomography/commit/\gitHash}{\gitAbbrevHash}\xspace|\xspace\insertframenumber/\inserttotalframenumber%
			}%
\mode<handout>{Handout for git.io/fjpP7, created on \DTMnow\xspace| p.\xspace\insertframenumber/\inserttotalframenumber}%
		\vspace{0.5ex}%
}
\addtobeamertemplate{footline}{}%
{%

	\begin{beamercolorbox}[wd=\paperwidth,center]{white}%
		\progressbar@progressbar%
	\end{beamercolorbox}%
}%
\makeatother

% Format bibliography for beamer
% http://tex.stackexchange.com/a/10686/828
\renewbibmacro{in:}{}
% http://tex.stackexchange.com/a/13076/828
\AtEveryBibitem{%
	\clearfield{journaltitle}
	\clearfield{pages}
	\clearfield{volume}
	\clearfield{number}
	\clearname{editor}
	\clearfield{issn}
	\clearfield{year}
}
% No parentheses around the (now empty) year: https://tex.stackexchange.com/a/147537/828
\renewcommand{\bibopenparen}{\addcomma\addspace}
\renewcommand{\bibcloseparen}{\addcomma\addspace}

% Redefine \footcite based on https://tex.stackexchange.com/a/453528/828
\DeclareCiteCommand{\footcite}[\mkbibfootnote]{%
	\usebibmacro{prenote}}{%
		\printnames[family-given]{labelname}%
		\newunit%
		\printfield{doi}%
		\newunit%
		\printlabeldateextra%
	}{\addsemicolon\space}{%
		\usebibmacro{postnote}%
	}%

% References as footnotes at the bottom of the slides
% https://tex.stackexchange.com/a/368760/828
\makeatletter
\renewcommand\@makefnmark{\xspace\hbox{\usebeamercolor[fg]{footnote mark}\usebeamerfont*{footnote mark}[\@thefnmark]}}
\renewcommand\@makefntext[1]{\tiny{\usebeamercolor[fg]{footnote mark}\usebeamerfont*{footnote mark}[\@thefnmark]}\enspace\usebeamerfont*{footnote} #1}
\makeatother

% Show current section at begin of sections, but only in presentation mode
\mode<beamer>{%
	\AtBeginSection[]{%
		\begin{frame}{Contents}%
			\tableofcontents[currentsection,currentsubsection,hideothersubsections]%
		\end{frame}%
	}%
}

% Move the text down a bit
% THIS IS A BIG HACK, IT SHOULD BE FIXED IN THE TEMPLATE
% But otherwise, the images are not aligned nicely into the gray background rectangle
\addtobeamertemplate{frametitle}{}{\vspace*{0.75em}}

\begin{document}
% No footline on the title page
% http://tex.stackexchange.com/a/18829/828 helps us to achieve that
{%
	\setbeamertemplate{footline}{}%
	\begin{frame}%
		\maketitle
	\end{frame}%
}

% % Alignment frames to test the ugly text-block-movement hack above
% \begin{frame}[label=current]{Alignment frame}
% 	\begin{tikzpicture}%
% 		\def\cut{2}%
% 		\draw [|-|] (0,\cut) -- (0,\textheight-\cut);%
% 		\draw [<->] (0.5\textwidth,\cut) -- (0.5\textwidth,\textheight-\cut);%
% 		\draw [|-|] (\textwidth,\cut) -- (\textwidth,\textheight-\cut);%
% 	\end{tikzpicture}%
% \end{frame}

% \begin{frame}[allowframebreaks,label=current]{Alignment frame II}
% 	\lipsum[1-3]
% \end{frame}

\begin{frame}
	\frametitle{Grüessech mitenang!}
	\begin{itemize}
		\item David Haberthür
		\begin{itemize}
			\item Physicist by trade
			\item \href{https://boris.unibe.ch/2619/}{PhD in high resolution imaging of the lung}, Institute of Anatomy, University of Bern, Switzerland
			\item Post-Doc I: \href{https://www.psi.ch/sls/tomcat/}{TOMCAT}, \href{https://www.psi.ch/sls/}{Swiss Light Source}, \href{https://www.psi.ch/}{Paul Scherrer Institute}, Switzerland
			\item Post-Doc II: \uct group, Institute of Anatomy, University of Bern, Switzerland.
		\end{itemize}
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Grüessech from the \uct-group}
	\centering
	\includegraphics[width=0.9\linewidth]{./images/team}
		\begin{columns}
		\hfill\begin{column}{0.3\linewidth}
			\centering%
			David{\color{ubRed!61.8}.}Haberthuer{\color{ubRed!61.8}@unibe.ch}%
		\end{column}
		\begin{column}{0.3\linewidth}
			\centering%
			Ruslan{\color{ubRed!61.8}.}Hlushchuk{\color{ubRed!61.8}@unibe.ch}%
		\end{column}
		\begin{column}{0.3\linewidth}
			\centering%
			Oleksiy{\color{ubRed!61.8}.}Khoma{\color{ubRed!61.8}@unibe.ch}%
		\end{column}\hfill%
	\end{columns}
\end{frame}

\begin{frame}
	\frametitle{\uct-group}
	\begin{columns}
		\begin{column}{0.61\linewidth}
			\begin{itemize}
				\item microangioCT~\cite{Hlushchuk2018}
				\begin{itemize}
					\item Angiogenesis: heart, musculature~\cite{Nording2021} and bones
					\item Vasculature: (mouse) brain~\cite{Hlushchuk2020}, (human) nerve scaffolds~\cite{Wuthrich2020}, (human) skin flaps~\cite{Zubler2021} and tumors
				\end{itemize}
				\item Zebrafish musculature and gills~\cite{MesserliAaldijk2020}
				\item (Lung) tumor detection and metastasis classification~\cite{Trappetti2021}
				\item Collaborations with museums~\cite{Bochud2021} and scientist at UniBe~\cite{Halm2021} to scan a wide range of specimens
				\item Automate \emph{all} the things!~\cite{Haberthuer2021, Haberthuer2023}
			\end{itemize}
		\end{column}%
		\begin{column}{0.37\linewidth}%
			\centering%
			\includegraphics<1|handout:0>[width=\imagewidth]{./images/1172}%
			\only<1|handout:0>{\source{brukersupport.com}{}}%
			\includegraphics<2|handout:1>[width=\imagewidth]{./images/1272}%
			\only<2|handout:1>{\source{bruker.com/skyscan1272}{}}%
			\includegraphics<3|handout:0>[width=\imagewidth]{./images/2214}%
			\only<3|handout:0>{\source{bruker.com/skyscan2214}{}}%
		\end{column}%
	\end{columns}%
\end{frame}

\begin{frame}{Contents}
	\tableofcontents
\end{frame}

\section{Overview}
\begin{frame}
	\frametitle{\uct}
	\begin{itemize}
		\item Dense and/or non‐transparent samples
		\item Calibrated \& isotropic 3D images at micron resolutions
		\item Covers a very large range of sample sizes
		\item Gives information at different length scales
	 	\item Nondestructive imaging, thus compatible with routine sample preparation.\newline
			Enables correlative imaging pipelines, scanning of museum \& collection material
	\end{itemize}
\end{frame}

\renewcommand{\imageheight}{0.65\textheight}
\begin{frame}
	\frametitle{Biomedical imaging}%
	\begin{columns}%
		\begin{column}{0.4\linewidth}%
			\begin{itemize}%
				\item<1-|handout:1-> Medical research%
				\item<1-|handout:1-> Non-destructive insights into the samples%
				\item<2-|handout:1-> (Small) Biological samples%
			\end{itemize}%
		\end{column}%
		\begin{column}{0.6\linewidth}%
			\centering%
			\only<1-2|handout:1>{%
				\includegraphics[height=\imageheight]{./images/Sagittal_brain_MRI}%
				\source{w.wiki/7g4}{\ccbysa}%
			}%
			\only<3|handout:2>{%
				\begin{tikzpicture}[remember picture,overlay]%
					\node at (current page.center){%
						\mode<beamer>{\animategraphics[loop,autoplay,width=\paperwidth,every=\everyframe]{24}{./movies/mouse_skull/mouse_skull}{000}{236}}%
						\mode<handout>{\includegraphics[width=\paperwidth]{./movies/mouse_skull/mouse_skull075}}
					};%
				\end{tikzpicture}%
			}%
		\end{column}%
	\end{columns}%
\end{frame}

\section{Imaging}
\begin{frame}
	\frametitle{Wavelength \& Scale}
	\centering
	\only<1|handout:1>{%
		\includegraphics[height=\imageheight]{./images/2000px-Electromagnetic_spectrum_with_sources}%
		\source{w.wiki/7fz}{\ccbysa}%
		}%
	\only<2|handout:2>{%
		\includegraphics[height=\imageheight]{./images/MIC-AM_techniques}%
		\sourcelink{anatomie.unibe.ch/tschanz}{Stefan Tschanz}{with permission}%
		}
\end{frame}

\begin{frame}
	\frametitle{Imaging methods}
	\begin{itemize}
		\item Light Sheet Microscopy: see \href{https://ilias.unibe.ch/goto_ilias3_unibe_sess_2774501.html}{lecture of Nadia Mercader Huber }
		\item X-ray imaging
		\item Electron microscopy
		\begin{itemize}
			\item \href{https://ilias.unibe.ch/goto_ilias3_unibe_sess_2774501.html}{\emph{Transmission Electron Microscopy} by Dimitri}
			\item \href{https://ilias.unibe.ch/goto_ilias3_unibe_sess_2177954.html}{\emph{Scanning Electron Microscopy} by Sabine Kässmeyer and Ivana Jaric}
			\item \href{https://ilias.unibe.ch/goto_ilias3_unibe_sess_2774507.html}{\emph{Cryoelectron Microscopy \& Serial Block Face SEM} by Ioan}
		\end{itemize}
	\end{itemize}
\end{frame}

\section{Tomography}
\begin{frame}
	\frametitle{CT-Scanner}
	\centering
	\mode<beamer>{%
		\animategraphics[loop,autoplay,height=0.618\textheight,every=\everyframe]{24}{./movies/ct-scanner/ct-scanner0}{001}{480}%
		\source{youtu.be/2CWpZKuy-NE}{}%
		}
	\mode<handout>{%
		\includegraphics[height=\imageheight]{./movies/ct-scanner/ct-scanner0001}%
		\source{youtu.be/2CWpZKuy-NE}{}%
		}
	\note{From \href{https://www.bruker.com/products/microtomography/micro-ct-for-sample-scanning/x-ray-micro-ct-microtomography.html}{Bruker Homepage}:
		Micro computed tomography or micro-CT is x-ray imaging in 3D, by the same method used in hospital CT (or CAT) scans, but on a small scale with massively increased resolution.
		It really represents 3D microscopy, where very fine scale internal structure of objects is imaged non-destructively.
		No sample preparation, no staining, no thin slicing - a single scan will image your sample's complete internal 3D structure at high resolution, plus you get your intact sample back at the end!}
\end{frame}

\subsection{History}
\begin{frame}
	\frametitle{CT History}
	\begin{columns}
		\begin{column}{0.49\linewidth}
			\begin{itemize}
				\item Long history
				\begin{itemize}
					\item \citeyear{Cormack1963}:~\citeauthor{Cormack1963} used a collimated \ce{^{60}Co} source and a Geiger counter as a detector~\cite{Cormack1963}%
					\item 1976:~\citeauthor{Hounsfield1976a} worked on first clinical scanner~\cite{Hounsfield1976a}%
					\item Nice overview by \citeauthor{Hsieh2003}~\cite{Hsieh2003}%
				\end{itemize}%
				\item<2-|handout:2-> CT scanner generations: First\uncover<3-|handout:3->{, second}\uncover<4|handout:4->{ and third}%
			\end{itemize}
		\end{column}
		\begin{column}{0.49\linewidth}
			\centering
 			\renewcommand{\imagewidth}{0.55\columnwidth}%
			\only<1|handout:1>{%
				\pgfmathsetlength{\imagescale}{\imagewidth/1055}%
			 	\def\x{652}% scalebar-x starting at golden ratio of image width of 1055px = 652
			 	\def\y{1328}% scalebar-y at 90% of image height of 1476px = 1328
				\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			 		\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/first_ct_image}};
			 		% 633.730px = 160.00000004mm -> 100px = 25247.344um -> 1.980px = 500um, 0.396px = 100um
			 		%\draw[|-|,blue,thick] (224,832) -- (858,826) node [sloped,midway,above,fill=white,semitransparent,text opacity=1] {\qty{160.00000004}{\milli\meter} (634px) TEMPORARY!};
					\draw[|-|,white,shadowed] (\x,\y) -- (\x+198.0,\y) node [midway,above] {\shadowtext{\qty{5}{\centi\meter}}};
				\end{tikzpicture}%
			}%
			\renewcommand{\imagewidth}{\columnwidth}%
			\only<1|handout:1>{\sourcecite{Beckmann2006}{Figure 5}}%
			\includegraphics<2|handout:2>[width=\imagewidth]{./images/History_Generation1}%
			\only<2|handout:2>{\sourcecite{Hsieh2003}{Figure 1.12}}%
			\includegraphics<3|handout:3>[width=\imagewidth]{./images/History_Generation2}%
			\only<3|handout:3>{\sourcecite{Hsieh2003}{Figure 1.13}}%
			\includegraphics<4|handout:4>[width=\imagewidth]{./images/History_Generation3}%
			\only<4|handout:4>{\sourcecite{Hsieh2003}{Figure 1.14}}%
		\end{column}
	\end{columns}
	\note<1|handout:1>{I was unable to find conclusive information on the voxel size of the first CT image.
		My head is approximately \qty{16}{\centi\meter} wide.
		I counted 47 voxels across the head in the image.
		This gives a voxel size of \qty{3.4}{\milli\meter} per voxel.}
\end{frame}

\begin{frame}[allowframebreaks]
	\frametitle{\uct History}
			\begin{itemize}
				\item X-ray computed tomography began to replace analog focal plane tomography in the early 1970s~\cite{Lin2019}
				\item \uct was first reported in the 1980s, for scanning gemstones
				\item Lee Feldkamp~\cite{Feldkamp1984} developed one of the early laboratory microCT systems by assembling a micro-focus cone beam x-ray source, specimen holder and stagers, and an image intensifier at Ford Motor Company’s Scientific Research Laboratory to nondestructively detect damage in ceramic manufactured automobile parts
				\item Met with scientists at Henry Ford Hospital and University of Michigan interested in understanding the relationship between the microstructure and biomechanical function of trabecular bone to study osteoporotic fractures~\cite{Feldkamp1983}
				\item CT scanners in medical diagnostics, beginning in the early 1970s
				\item Non-medical use in the late 1970s, for detection of internal defects in fabricated parts and equipment
				\item Today: Nondestructive imaging for quantifying the microstructure of organic materials, particularly mineralized bone tissue and the relationships between the mechanical behavior of bone to its structural and compositional properties
				\item Since the 1990s, \uct includes imaging of soft tissues and vasculature using radio-opaque contrast agents
				\item \(\approx\)2500 \uct systems are in use worldwide with over 1000 publications annually
			\end{itemize}
\end{frame}

\subsection{Interaction of x-rays with matter}
\begin{frame}
	\frametitle{X-ray interaction}
	\begin{itemize}
		\item \textquote[\cite{xrayphysics}]{X-rays interact with tissue in 2 main ways: photoelectric effect and Compton scatter.
				To a first approximation, the photoelectric effect contributes to contrast while the Compton effect contributes to noise.
				Both contribute to dose.}
		\begin{itemize}
			\item Photoelectric absorption (\(\tau\)) is strongly dependent on the atomic number \(Z\) of the absorbing material: \(\tau\propto\frac{Z^4}{E^{3.5}}\)
			\note{From \href{https://radiopaedia.org/articles/photoelectric-effect}{Radiopaedia.org}: Therefore if \(Z\) doubles, PEA will increase by a factor of 16 (\(2^4=16\)), and if \(E\) doubles PEA will be reduced by a factor of 11.
				Small changes in \(Z\) and \(E\) can therefore significantly affect PEA.
				This has practical implications in the field of radiation protection and is the reason why materials with a high \(Z\) such as lead (\(Z= 82\)) are useful shielding materials.
				The dependence of PEA on \(Z\) and \(E\) means that it is the major contributor to beam attenuation up to approximately \qty{30}{\kilo\electronvolt} when human tissues (\(Z=7.4\)) are irradiated.
				At beam energies above this, the Compton effect predominates.}
			\item Compton scattering is one of the principle forms of photon interaction and is directly proportional to the (electron \& physical) density of the material.
				It does \emph{not} depend on the atomic number: \(\lambda' - \lambda = \frac{h}{m_e c}\left(1-\cos{\theta}\right)\)
			\note{Where \(\lambda\) is the initial wavelength, \(\lambda'\) is the wavelength after scattering, \(h\) is the Planck constant, \(m_e\) is the electron rest mass, \(c\) is the speed of light, and \(\theta\) is the scattering angle.}
		\end{itemize}
		\item Lowering x-ray energy increases contrast
		\item X-ray penetration decreases exponentially with sample thickness~\cite[\ie Beer-Lamberts law]{wiki:beer-lambert}: \(I(t) = I_0 \, e^{-\alpha z}\)
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Composition of biological tissues}
	Tissue: content by mass percentage
	\centering
	\begin{table}%
		\only<1>{%
			\pgfplotstabletypeset[%
				col sep=comma,% the seperator in our .csv file
				display columns/0/.style={string type},%
				% section 3.2 in pgfplotstable manual
				every head row/.style={before row={\toprule}},%
				every row no 0/.style={after row=\midrule},%
				every last row/.style={after row=\bottomrule},%
			]{./tables/tissue-composition.csv}%
		}%
		\only<2|handout:0>{%
			\pgfplotstabletypeset[%
				col sep=comma,% the seperator in our .csv file
				display columns/0/.style={string type},%
				every head row/.style={before row={\toprule}},%
				every row no 0/.style={after row=\midrule},%
				every last row/.style={after row=\bottomrule},%
				% make certain cells ubRed, based on https://tex.stackexchange.com/a/296914/828
				every row 1 column 2/.style={postproc cell content/.append style={/pgfplots/table/@cell content/.add={\cellcolor{ubRed!61.8}}{}}},%
				every row 1 column 4/.style={postproc cell content/.append style={/pgfplots/table/@cell content/.add={\cellcolor{ubRed!61.8}}{}}},%
				every row 6 column 6/.style={postproc cell content/.append style={/pgfplots/table/@cell content/.add={\cellcolor{ubRed!61.8}}{}}},%
				every row 6 column 10/.style={postproc cell content/.append style={/pgfplots/table/@cell content/.add={\cellcolor{ubRed!61.8}}{}}}%
			]{./tables/tissue-composition.csv}%
		}%
	\end{table}
	\note{Bone, lean tissue, fat and air can be distinguished quite easily}
\end{frame}

\renewcommand{\imagewidth}{\columnwidth}
\begin{frame}
	\frametitle{Why \uct?}
	\begin{columns}
		\begin{column}{0.49\linewidth}
			% https://www.cancerimagingarchive.net/nbia-search/?saved-cart=nbia-76761575299081509
			\only<1-4|handout:1-4>{%
				\pgfmathsetlength{\imagescale}{\imagewidth/512}%
				\def\x{316}% scalebar-x starting at golden ratio of image width of 512px = 316
				\def\y{361}% scalebar-y at 90% of image height of 401px = 361
				\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
					\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/comparison/MAX_human}};
					% 512.000px = 250.0096mm -> 100px = 48830.000um -> 1.024px = 500um, 0.205px = 100um
					%\draw[|-|,blue,thick] (0,200) -- (512,200) node [sloped,midway,above,fill=white,semitransparent,text opacity=1] {\qty{250.0096}{\milli\meter} (512px) TEMPORARY!};
					\draw[|-|,white,shadowed] (\x,\y) -- (\x+102.4,\y) node [midway,above] {\shadowtext{\qty{5}{\centi\meter}}};
				\end{tikzpicture}%
			}%
			\only<5|handout:0>{%
				\pgfmathsetlength{\imagescale}{\imagewidth/512}%
				\def\x{316}% scalebar-x starting at golden ratio of image width of 512px = 316
				\def\y{361}% scalebar-y at 90% of image height of 401px = 361
				\def\mag{5}% magnification of inset
				\def\size{100}% size of inset
				\begin{tikzpicture}[x=\imagescale,y=-\imagescale,spy using outlines={rectangle,magnification=\mag,size=\size,connect spies}]
					\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/comparison/MAX_human}};
					\spy [red] on (102,342) in node at (256,201) [anchor=center];
					% 512.000px = 250.0096mm -> 100px = 48830.000um -> 1.024px = 500um, 0.205px = 100um
					\draw[|-|,white,shadowed] (\x,\y) -- (\x+102.4,\y) node [midway,above] {\shadowtext{\qty{5}{\centi\meter}}};
				\end{tikzpicture}%
			}%
			\renewcommand{\imagewidth}{0.1554\columnwidth}%
			\only<6|handout:5>{%
				\centering
				\pgfmathsetlength{\imagescale}{\imagewidth/512}%
				\def\x{316}% scalebar-x starting at golden ratio of image width of 512px = 316
				\def\y{361}% scalebar-y at 90% of image height of 401px = 361
				\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
					\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/comparison/MAX_human}};
					% 512.000px = 250.0096mm -> 100px = 48830.000um -> 1.024px = 500um, 0.205px = 100um
					\draw[|-|,white,shadowed] (\x,\y) -- (\x+102.4,\y) node [midway,above] {\shadowtext{\qty{5}{\centi\meter}}};
				\end{tikzpicture}%
			}%
			\sourcecite{Clark2013}{Subject \emph{C3L-02465}}
		\end{column}%
		\begin{column}{0.49\linewidth}
			\only<1|handout:1>{%
				\pgfmathsetlength{\imagescale}{\imagewidth/3295}%
				\def\x{2036}% scalebar-x starting at golden ratio of image width of 3295px = 2036
				\def\y{1343}% scalebar-y at 90% of image height of 1492px = 1343
				\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
					\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/comparison/MAX_mouse}};
					% 3295.000px = 26.2282mm -> 100px = 796.000um -> 62.814px = 500um, 12.563px = 100um
					%\draw[|-|,blue,thick] (0,746) -- (3295,746) node [sloped,midway,above,fill=white,semitransparent,text opacity=1] {\qty{26.2282}{\milli\meter} (3295px) TEMPORARY!};
					\draw[|-|,white,shadowed] (\x,\y) -- (\x+628.14,\y) node [midway,above] {\shadowtext{\qty{5}{\milli\meter}}};
				\end{tikzpicture}%
			}%
			\renewcommand{\imagewidth}{0.1\columnwidth}%
			\only<2|handout:2>{%
				\centering
				\pgfmathsetlength{\imagescale}{\imagewidth/54}%
				\def\x{33}% scalebar-x starting at golden ratio of image width of 54px = 33
				\def\y{22}% scalebar-y at 90% of image height of 24px = 22
				\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
					\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/comparison/MAX_mouse_488umppx}};
					% 54.000px = 26.3682mm -> 100px = 48830.000um -> 1.024px = 500um, 0.205px = 100um
					%\draw[|-|,blue,thick] (0,12) -- (54,12) node [sloped,midway,above,fill=white,semitransparent,text opacity=1] {\qty{26.3682}{\milli\meter} (54px) TEMPORARY!};
					\draw[|-|,white,shadowed] (\x,\y) -- (\x+102.4,\y) node [midway,above] {\shadowtext{\qty{5}{\centi\meter}}};
					%\draw[color=red, anchor=south west] (0,24) node [fill=white, semitransparent] {Legend} node {Legend};
				\end{tikzpicture}%
			}%
			\renewcommand{\imagewidth}{\columnwidth}
			\only<3|handout:3>{%
				\centering
				\pgfmathsetlength{\imagescale}{\imagewidth/54}%
				\def\x{33}% scalebar-x starting at golden ratio of image width of 54px = 33
				\def\y{22}% scalebar-y at 90% of image height of 24px = 22
				\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
					\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/comparison/MAX_mouse_488umppx}};
					% 54.000px = 26.3682mm -> 100px = 48830.000um -> 1.024px = 500um, 0.205px = 100um
					%\draw[|-|,blue,thick] (0,12) -- (54,12) node [sloped,midway,above,fill=white,semitransparent,text opacity=1] {\qty{26.3682}{\milli\meter} (54px) TEMPORARY!};
					\draw[|-|,white,shadowed] (\x,\y) -- (\x+10.24,\y) node [midway,above] {\shadowtext{\qty{5}{\milli\meter}}};
					%\draw[color=red, anchor=south west] (0,24) node [fill=white, semitransparent] {Legend} node {Legend};
				\end{tikzpicture}%
			}%
			\only<4|handout:4>{%
				\pgfmathsetlength{\imagescale}{\imagewidth/3295}%
				\def\x{2036}% scalebar-x starting at golden ratio of image width of 3295px = 2036
				\def\y{1343}% scalebar-y at 90% of image height of 1492px = 1343
				\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
					\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/comparison/MAX_mouse}};
					% 3295.000px = 26.2282mm -> 100px = 796.000um -> 62.814px = 500um, 12.563px = 100um
					\draw[|-|,white,shadowed] (\x,\y) -- (\x+628.14,\y) node [midway,above] {\shadowtext{\qty{5}{\milli\meter}}};
				\end{tikzpicture}%
			}%
			\only<5|handout:0>{%
				\pgfmathsetlength{\imagescale}{\imagewidth/3295}%
				\def\x{2036}% scalebar-x starting at golden ratio of image width of 3295px = 2036
				\def\y{1343}% scalebar-y at 90% of image height of 1492px = 1343
				\def\mag{5}% magnification of inset
				\def\size{100}% size of inset
				\begin{tikzpicture}[x=\imagescale,y=-\imagescale,spy using outlines={rectangle,magnification=\mag,size=\size,connect spies}]
					\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/comparison/MAX_mouse}};
					\spy [red] on (352,1116) in node at (1648,746) [anchor=center];
					% 3295.000px = 26.2282mm -> 100px = 796.000um -> 62.814px = 500um, 12.563px = 100um
					\draw[|-|,white,shadowed] (\x,\y) -- (\x+628.14,\y) node [midway,above] {\shadowtext{\qty{5}{\milli\meter}}};
				\end{tikzpicture}%
			}%
			\only<6|handout:5>{%
				\pgfmathsetlength{\imagescale}{\imagewidth/3295}%
				\def\x{2036}% scalebar-x starting at golden ratio of image width of 3295px = 2036
				\def\y{1343}% scalebar-y at 90% of image height of 1492px = 1343
				\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
					\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/comparison/MAX_mouse}};
					% 3295.000px = 26.2282mm -> 100px = 796.000um -> 62.814px = 500um, 12.563px = 100um
					\draw[|-|,white,shadowed] (\x,\y) -- (\x+628.14,\y) node [midway,above] {\shadowtext{\qty{5}{\milli\meter}}};
				\end{tikzpicture}%
			}%
		\end{column}
	\end{columns}
	\note<1|handout:1>{The human head scan was downloaded from the \href{https://www.cancerimagingarchive.net}{Cancer Imaging Archive}.
		We loaded the DICOM slices in Fiji, resliced it to show it from the side and then used to generate an MIP.
		According to the DICOM tags, the voxel size is \qtyproduct{0.4883 x 0.4883 x 0.625}{\milli\meter\cubed}, the image size is \numproduct{512 x 512} pixels.
		The mouse head is the same as shown in the early animation.
		The files from the early animation were resized 0.25 times; here we used the original dataset (Mouse1265\_Skull\_Gaby\_TKI\_7\_96um\_Al05\_2K) for a reslice and the generation of the MIP.
		The voxel size of the original data is \qty{7.96}{\micro\meter}, the image size is \numproduct{3295 x 1492} pixels.}
\end{frame}

\renewcommand{\imageheight}{0.618\paperheight}
\begin{frame}
	\frametitle{Maximum intensity projection}
	\centering
	% Download Guillaumes 'current' slide as PNG from https://ilias.unibe.ch/ilias.php?baseClass=ilLinkResourceHandlerGUI&ref_id=2856632&cmd=calldirectlink
	\includegraphics[height=\imageheight]{./images/Fundamentals_image_processing_2023.png}%
	\sourcelink{ilias.unibe.ch/goto_ilias3_unibe_sess_2774485.html}{\emph{Fundamentals of Digital Image Processing (2023)} by Guillaume Witz}{Slide 24}%
\end{frame}

\subsection{Tomography today}
\renewcommand{\imageheight}{0.618\paperheight}
\begin{frame}
	\frametitle{Machinery}
	\begin{columns}%
		\begin{column}{0.45\linewidth}%
			\begin{itemize}%
				\item<1-> Hospital CT%
				\begin{itemize}%
					\item Voxel size around \qty{0.5}{\milli\meter}%
				\end{itemize}%
				\item<2-> Lab/Desktop CT%
				\begin{itemize}%
					\item Voxel size around \qty{7}{\micro\meter} (\emph{in vivo}) or \qty{0.5}{\micro\meter} (\emph{ex vivo})%
				\end{itemize}%
				\item<4-> Synchrotron CT%
				\begin{itemize}%
					\item Voxel size down to \href{https://www.psi.ch/en/sls/tomcat/detectors}{\qty{160}{\nano\meter}}%
				\end{itemize}%
			\end{itemize}%
		\end{column}%
		\begin{column}{0.55\linewidth}%
			\centering%
			\includegraphics<1|handout:1>[height=\imageheight]{./images/24324062640_751e011e1a_o}%
			\only<1|handout:1>{\source{flic.kr/p/D4rbom}{\ccbyncsa}}%
			\includegraphics<2|handout:2>[width=\imageheight]{./images/9459311320_516179207a_o}%
			\only<2|handout:2>{\source{flic.kr/p/fpTrGu}{\ccbysa}}%
			\includegraphics<3|handout:3>[width=\imagewidth]{./images/1272}%
			\only<3|handout:3>{\source{bruker.com/skyscan1272}{}}%
			\includegraphics<4|handout:4>[width=\imagewidth]{./images/4563733710_f632792416_b}%
			\only<4|handout:4>{\source{flic.kr/p/7Xhk2Y}{\ccbync}}%
			%trim={<left> <lower> <right> <upper>}
			\includegraphics<5|handout:0>[trim={430 0 290 0},clip,width=\imagewidth]{./images/4563733710_f632792416_b}%
			\only<5|handout:0>{\source{flic.kr/p/7Xhk2Y}{\ccbync}}%
		\end{column}%
	\end{columns}%
\end{frame}
\note{FAN BEAM -> BRUKER\newline
	PARALLEL BEAM -> TOMCAT\newline
	HELICAL/SPIRAL CT\newline
	MULTISLICE CT -> HOSPITAL
}

\renewcommand{\imagewidth}{\linewidth}
\begin{frame}
	\frametitle{What is happening?}
	\begin{columns}%
		\begin{column}{0.49\linewidth}%
			No matter what kind of machine, the basic principle is always the same
			\begin{itemize}
				\item an x-ray source
				\item a sample
				\item a detector
			\end{itemize}
		\end{column}%
		\begin{column}{0.49\linewidth}%
			\centering%
			\includegraphics[width=\imagewidth]{./images/3D_Computed_Tomography}%
			\source{w.wiki/7g3}{\ccbysa}%
		\end{column}%
	\end{columns}%
\end{frame}

\begin{frame}
	\frametitle{Machinery}
	\begin{columns}
		\begin{column}{0.49\linewidth}
			\centering
			\input{animations/classicCT}
		\end{column}
		\begin{column}{0.49\linewidth}
			\centering
			\only<1>{\input{animations/microCT}}%
			\only<2|handout:0>{\input{animations/microCT_lr}}%
			\only<3|handout:0>{\input{animations/microCT_hr}}%
		\end{column}
	\end{columns}
\end{frame}

\begin{frame}
	\frametitle{Examples}
	\centering%
	\only<1|handout:1>{%
		\pgfmathsetlength{\imagewidth}{0.9\linewidth}%
		\pgfmathsetlength{\imagescale}{\imagewidth/3295}%
		\def\x{2036}% scalebar-x starting at golden ratio of image width of 3295px = 2036
		\def\y{1343}% scalebar-y at 90% of image height of 1492px = 1343
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/Mouse1265_resliced_MIP500um}};
			% 3295.000px = 26.2282mm -> 100px = 796.000um -> 62.814px = 500um, 12.563px = 100um
			%\draw[|-|,blue,thick] (0,746) -- (3295,746) node [sloped,midway,above,fill=white,semitransparent,text opacity=1] {\qty{26.2282}{\milli\meter} (3295px) TEMPORARY!};
			\draw[|-|,white,shadowed] (\x,\y) -- (\x+628.14,\y) node [midway,above] {\shadowtext{\qty{5}{\milli\meter}}};
		\end{tikzpicture}%
	}%
	\pgfmathsetlength{\imagewidth}{0.5\linewidth}%
	\pgfmathsetlength{\imagescale}{\imagewidth/2301}%
	\def\x{1422+450}% scalebar-x starting at golden ratio of image width of 2301px = 1422
	\def\y{1715}% scalebar-y at 90% of image height of 1906px = 1715
	\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
		\only<2|handout:2>{%
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/2834_left_post_Cu_011_1272_360_5um_reslice}};
		}%
		\only<3|handout:0>{%
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/2834_left_post_Cu_011_1272_360_5um_reslice_stretched}};
		}%
		% 2301.000px = 11.505mm -> 100px = 500.000um -> 100.000px = 500um, 20.000px = 100um
		%\draw[|-|,blue,thick] (0,953) -- (2301,953) node [sloped,midway,above,fill=white,semitransparent,text opacity=1] {\qty{11.505}{\milli\meter} (2301px) TEMPORARY!};
		\only<2-3|handout:2>{%
			\draw[|-|,white,shadowed] (\x,\y) -- (\x+200,\y) node [midway,above] {\shadowtext{\qty{1}{\milli\meter}}};
		}%
	\end{tikzpicture}%
	\only<4|handout:3>{%
		\pgfmathsetlength{\imagewidth}{\linewidth}%
		\pgfmathsetlength{\imagescale}{\imagewidth/387}%
		\def\x{239}% scalebar-x starting at golden ratio of image width of 387px = 239
		\def\y{279}% scalebar-y at 90% of image height of 310px = 279
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./movies/diancta/Diancta_rec00000666}};
			% 387.000px = 2.9025mm -> 100px = 750.000um -> 66.667px = 500um, 13.333px = 100um
			%\draw[|-|,blue,thick] (0,155) -- (387,155) node [sloped,midway,above,fill=white,semitransparent,text opacity=1] {\qty{2.9025}{\milli\meter} (387px) TEMPORARY!};
			\draw[|-|,white,shadowed] (\x,\y) -- (\x+66.667,\y) node [midway,above] {\shadowtext{\qty{500}{\micro\meter}}};
		\end{tikzpicture}%
		\sourcecite{Bochud2021}{\emph{Diancta phoenīx}}%
	}%
	\only<5|handout:0>{%
		\animategraphics[autoplay,palindrome,width=\imagewidth,every=\everyframe]{24}{./movies/diancta/Diancta_rec00000}{565}{904}%
		\sourcecite{Bochud2021}{\emph{Diancta phoenīx}}%
	}%
	\only<6|handout:4>{%
		\pgfmathsetlength{\imagewidth}{0.8\linewidth}%
		\pgfmathsetlength{\imagescale}{\imagewidth/1224}%
		\def\x{756}% scalebar-x starting at golden ratio of image width of 1224px = 756
		\def\y{1102}% scalebar-y at 90% of image height of 1224px = 1102
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/Toothpick_rec00000555}};
			% 1224.000px = 2.754mm -> 100px = 225.000um -> 222.222px = 500um, 44.444px = 100um
			%\draw[|-|,blue,thick] (0,612) -- (1224,612) node [sloped,midway,above,fill=white,semitransparent,text opacity=1] {\qty{2.754}{\milli\meter} (1224px) TEMPORARY!};
			\draw[|-|,white,shadowed] (\x,\y) -- (\x+222.222,\y) node [midway,above] {\shadowtext{\qty{500}{\micro\meter}}};
		\end{tikzpicture}%
	}%
	\only<7|handout:5>{%
		\pgfmathsetlength{\imagewidth}{\linewidth}%
		\pgfmathsetlength{\imagescale}{\imagewidth/708}%
		\def\x{438+150}% scalebar-x starting at golden ratio of image width of 708px = 438
		\def\y{463}% scalebar-y at 90% of image height of 514px = 463
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/KP-TNIKWT2_rec_reslice_MIP500um}};
			% 708.000px = 15.292800000000002mm -> 100px = 2160.000um -> 23.148px = 500um, 4.630px = 100um
			%\draw[|-|,blue,thick] (0,257) -- (708,257) node [sloped,midway,above,fill=white,semitransparent,text opacity=1] {\qty{15.292800000000002}{\milli\meter} (708px) TEMPORARY!};
			\draw[|-|,white,shadowed] (\x,\y) -- (\x+46.3,\y) node [midway,above] {\shadowtext{\qty{1}{\milli\meter}}};
		\end{tikzpicture}%
	}%
\end{frame}

\section{A scan, from \emph{getting started} to \emph{nice image}}
\begin{frame}
	\frametitle{Preparation}
	\begin{itemize}
		\item Study design
		\item Sample preparation
	\end{itemize}
\end{frame}

\renewcommand{\imageheight}{0.618\paperheight}%
\begin{frame}
	\frametitle{Projections}
	\centering
	% Download Martins slides from https://ilias.unibe.ch/goto_ilias3_unibe_file_2867533_download.html
	% pdfseparate physical\ basics_2023_folien.pdf -f 21 -l 21 physical_basics_2023_folien-%d.pdf
	\includegraphics[height=\imageheight]{./images/physical_basics_2023_folien-21.pdf}%
	\sourcelink{ilias.unibe.ch/goto_ilias3_unibe_sess_2774486.html}{\emph{Contrast, Magnification and Resolution---Laws of Physics for Microscopists (1, 2023)} by Martin Frenz}{Slide 21}%
\end{frame}

\renewcommand{\imageheight}{0.618\paperheight}
\begin{frame}
	\frametitle{Projection acquisition}
	\centering
	\includegraphics<1|handout:0>[height=\imageheight]{./images/2214}%
	\includegraphics<2|handout:0>[height=\imageheight]{./images/2214/room}%
	\includegraphics<3|handout:0>[height=\imageheight]{./images/2214/scanning_compartement}%
	\includegraphics<4|handout:1>[height=\imageheight]{./images/2214/ControlSoftware01}%
\end{frame}

\renewcommand{\imageheight}{0.618\paperheight}
\begin{frame}
	\frametitle{Projections}
	\centering
	% Movie frames generated with https://github.com/habi/Lecture.Microtomography/blob/master/Notebooks/FromProjectionsToReconstructions.ipynb
	\mode<beamer>{\animategraphics[autoplay,loop,height=\imageheight,every=\everyframe]{24}{./movies/scan/projections/KP-TNIKWT02_360_projections_of_940_800_px_}{000}{359}}
	\mode<handout>{\includegraphics[height=\imageheight]{./movies/scan/projections/KP-TNIKWT02_360_projections_of_940_800_px_180}}
\end{frame}

\begin{frame}
	\frametitle{Projections}
	\begin{itemize}
		\item A (micro-focus) x-ray source illuminates the object
		\item The x-rays penetrate the sample and are attenuated
		\item A scintillator converts the x-rays to visible light
		\item A (planar) x-ray detector collects (magnified) projection images.
		\item The projections are recorded on disk
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Reconstructions}
	\centering
	\includegraphics<1|handout:1>[height=\imageheight]{./images/2214/NRecon_proj}%
	\includegraphics<2|handout:2>[height=\imageheight]{./images/2214/NRecon_rec}%
\end{frame}

\begin{frame}
	\frametitle{Reconstructions}
	\centering
	% Movie frames generated with https://github.com/habi/Lecture.Microtomography/blob/master/Notebooks/FromProjectionsToReconstructions.ipynb
	\mode<beamer>{\animategraphics[autoplay,palindrome,height=\imageheight,every=\everyframe]{24}{./movies/scan/reconstructions/KP-TNIKWT02_360_reconstructions_of_552_800_px_}{000}{359}}
	\mode<handout>{\includegraphics[height=\imageheight]{./movies/scan/reconstructions/KP-TNIKWT02_360_reconstructions_of_552_800_px_180}}
\end{frame}

\begin{frame}
	\frametitle{Reconstructions}
	\begin{itemize}
		\item Based on hundreds of angular views acquired while the object rotates, a computer synthesizes a stack of virtual cross section slices through the object.
		\item Radon Transformation
		\item Filtered back projection
		\item Fan beam reconstruction
		\item Corrections (beam hardening, etc.)
		\item Writing to stack
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Visualization}
	\begin{tikzpicture}[remember picture,overlay]%
	\node at (current page.center){%
		\mode<beamer>{\animategraphics[autoplay,loop,height=\paperheight,every=\everyframe]{24}{./movies/scan/visualization/lung}{000}{240}}%
		\mode<handout>{\includegraphics[height=\paperheight]{./movies/scan/visualization/lung000}}%
		};%
	\end{tikzpicture}%
\end{frame}

\begin{frame}
	\frametitle{Visualization}
	\begin{itemize}
		\item Based the on reconstructions, a computer synthesizes a three-dimensional view of the scanned sample
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{What to use?}
	\begin{itemize}
		\item \href{http://fiji.sc/}{ImageJ/Fiji}~\cite{Schindelin2012}
		\item Also see \href{https://ilias.unibe.ch/goto_ilias3_unibe_sess_2774485.html}{\emph{Fundamentals of Digital Image Processing} by Guillaume Witz}
		\item Reproducible research
		\begin{itemize}
			\item \href{https://www.python.org/}{\faPython} in \href{https://jupyter.org/}{Jupyter}~\cite{Kluyver2016}
			\item \href{https://git-scm.com/}{\faGit}
			\item Script all your things!
			\item Data repositories; \ie sharing is caring!
		\end{itemize}
	\end{itemize}
\end{frame}

\section{Examples}
\subsection{A study about teeth}
\begin{frame}
	\frametitle{Quantitative data}
	\begin{itemize}
		\item Pretty images are nice, but we need quantitative numbers
		\item Segmentation
		\item Characterization
	\end{itemize}
\end{frame}

\subsubsection{Overview}
\begin{frame}
	\frametitle{Internal morphology of human teeth}%
	Collaboration with \href{https://www.zmk.unibe.ch/}{zmk bern – Zahnmedizinische Kliniken}%
	\begin{itemize}%
		\item Numbers instead of just pretty images%
		\item Segmentation of teeth and root canal%
		\item (Unbiased) Characterization%
		\item Reproducible and automated image analysis (\href{https://www.python.org/}{\faPython} in \href{https://jupyter.org/}{Jupyter}~\cite{Kluyver2016})%
		\item Two publications:%
		\begin{itemize}%
			\item \cite{Haberthuer2021}, \href{https://bmcoralhealth.biomedcentral.com/articles/10.1186/s12903-021-01551-x}{BMC Oral Health, doi.org/gjpw2d}%
			\item \cite{Wolf2021}, \href{https://www.nature.com/articles/s41598-021-00758-w}{Scientific Reports, doi.org/g7r8}%
		\end{itemize}%
	\end{itemize}%
	\begin{tikzpicture}[remember picture,overlay]%
		\node at (current page.center) [shift={(0,-25pt)}]{%
		\mode<beamer>{\animategraphics[autoplay,loop,width=\paperwidth,every=\everyframe]{24}{./movies/tooth045/full/image0}{000}{474}}%
		\mode<handout>{\includegraphics[width=\paperwidth]{./movies/tooth045/full/image0237}}%
			};%
	\end{tikzpicture}%
\end{frame}

\begin{frame}
	\frametitle{Internal morphology of human teeth}%
	Collaboration with \href{https://www.zmk.unibe.ch/}{zmk bern – Zahnmedizinische Kliniken}%
	\begin{itemize}%
		\item Numbers instead of just pretty images%
		\item Segmentation of teeth and root canal%
		\item (Unbiased) Characterization%
		\item Reproducible and automated image analysis (\href{https://www.python.org/}{\faPython} in \href{https://jupyter.org/}{Jupyter}~\cite{Kluyver2016})%
		\item Two publications:%
		\begin{itemize}%
			\item \cite{Haberthuer2021}, \href{https://bmcoralhealth.biomedcentral.com/articles/10.1186/s12903-021-01551-x}{BMC Oral Health, doi.org/gjpw2d}%
			\item \cite{Wolf2021}, \href{https://www.nature.com/articles/s41598-021-00758-w}{Scientific Reports, doi.org/g7r8}%
		\end{itemize}%
	\end{itemize}%
\end{frame}

\subsubsection{Materials \& Methods}
\renewcommand{\imagewidth}{0.75\linewidth}
\renewcommand{\imageheight}{0.618\paperheight}
\begin{frame}
	\frametitle{How?}
	\begin{columns}
		\begin{column}{0.5\linewidth}
			\begin{itemize}
				\item<1-> 104 extracted human permanent mandibular canines
				\item<2-> \uct imaging
				\item<5-> Root canal configuration, according to~\citeauthor{Briseno-Marroquin2015}~\cite{Briseno-Marroquin2015}
				\item<6-> \emph{Reproducible} analysis~\cite{Haberthuer2020a}\onslide<7>{, \eg you can \href{https://mybinder.org/v2/gh/habi/zmk-tooth-cohort/master?filepath=ToothAnalysis.ipynb}{click a button to double-check} or \href{https://nbviewer.jupyter.org/github/habi/zmk-tooth-cohort/blob/master/ToothAnalysis.ipynb}{recalculate the results yourself!}}
			\end{itemize}
		\end{column}
		\begin{column}{0.5\linewidth}
			\only<1|handout:1>{%
				\centering%
				\pgfmathsetlength{\imagescale}{\imagewidth/2716}%
				\def\x{1678}% scalebar-x starting at golden ratio of image width of 2716px = 1678
				\def\y{2444}% scalebar-y at 90% of image height of 2716px = 2444
				\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
					\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/zmk/bucketofteeth}};
					% 2132.087px = 140.0mm -> 100px = 6566.337um -> 7.615px = 500um, 1.523px = 100um
					%\draw[|-|,blue,thick] (299,1340) -- (2430,1406) node [sloped,midway,above,fill=white,semitransparent,text opacity=1] {\qty{140.0}{\milli\meter} (2132px) TEMPORARY!};
					\draw[|-|,white,shadowed] (\x,\y) -- (\x+761.5,\y) node [midway,above] {\shadowtext{\qty{5}{\centi\meter}}};
				\end{tikzpicture}%
				}%
			\only<2|handout:2>{%
				\centering%
				\includegraphics[width=\imagewidth]{./images/1272}%
				\source{bruker.com/skyscan1272}{}%
				}%
			\only<3|handout:3>{%
				\lstinputlisting[linerange={2-4,15-15,17-19,28-30,36-37,40-40,44-44,53-54}]{./logfiles/Tooth045.log}%
				}%
			\only<4|handout:4>{%
				\emph{Sample changer} on the SkyScan 1272\newline
				In total:
				\begin{itemize}
					\item 13 days of \emph{continuous} \uct scanning
					\item \qty{819}{\giga\byte} of raw data\newline\num{230648} TIFF projections
					\item \qty{326}{\giga\byte} data as input for analysis\newline\num{282062} PNG reconstructions
				\end{itemize}
					}%
			\renewcommand{\imagewidth}{\linewidth}%
			\only<5|handout:5>{%
				\centering%
				\includegraphics[width=\imagewidth]{./images/zmk/briseno}%
				\sourcecite{Briseno-Marroquin2015}{Fig.~2}%
				}%
			\only<6|handout:6>{%
				\centering%
				\includegraphics[width=\imagewidth]{./images/zmk/foramen}%
				\sourcecite{Wolf2017}{Fig.~1}%
				}%
			\only<7|handout:7>{%
				\centering%
				\mode<beamer>{%
					\animategraphics[loop,autoplay,width=\linewidth,every=\everyframe]{24}{./movies/coder/coder-}{0}{133}%
					\source{gph.is/2nqkple}{}%
					}%
				\mode<handout>{%
					\includegraphics[width=\linewidth]{./movies/coder/coder-65}%
					\source{gph.is/2nqkple}{}%
					}%
				}%
			\only<8|handout:8>{%
				\centering%
				\href{https://mybinder.org/v2/gh/habi/zmk-tooth-cohort/master?filepath=ToothAnalysis.ipynb}{\includegraphics[height=\imageheight]{./images/zmk/binder}}%
				}%
		\end{column}
	\end{columns}
\end{frame}

\subsubsection{Results}
\renewcommand{\imageheight}{0.618\paperheight}
\begin{frame}
	\frametitle{\uct imaging}
	\centering
	\includegraphics<1|handout:0>[height=\imageheight]{./images/zmk/ScanOverviews.104.png}%
	\includegraphics<2>[height=\imageheight]{./images/zmk/ScanOverviews.24.png}%
\end{frame}

\renewcommand{\imagewidth}{\linewidth}
\begin{frame}
	\frametitle{Dataset cropping}
	\begin{columns}
		\begin{column}{0.382\linewidth}
			\begin{itemize}
				\item Full datasets: \qty{326}{\giga\byte}%
				\item<2> Cropped datasets: \qty{115}{\giga\byte}%
			\end{itemize}
		\end{column}
		\begin{column}{0.618\linewidth}
			\centering%
			\includegraphics<1|handout:1>[width=\imagewidth]{./images/zmk/tooth045/Tooth045.Cropper.Original.png}%
			\includegraphics<2|handout:2>[width=\imagewidth]{./images/zmk/tooth045/Tooth045.Cropper.Cropped.png}%
		\end{column}
	\end{columns}
\end{frame}

\begin{frame}
	\frametitle{Tooth morphology}
	\begin{tikzpicture}[remember picture,overlay]%
		\node at (current page.center) [shift={(0,-25pt)}]{%
			\only<1|handout:1>{%
				\mode<beamer>{%
					\animategraphics[autoplay,loop,width=\paperwidth,every=\everyframe]{24}{./movies/tooth045/full/image0}{000}{474}%
					}%
				\mode<handout>{%
					\includegraphics[width=\paperwidth]{./movies/tooth045/full/image0000}%
					}%
				}%
			\only<2|handout:2>{\includegraphics[height=\imageheight]{./images/zmk/briseno}\sourcecite{Briseno-Marroquin2015}{Fig.~2}}%
			\only<3|handout:3>{%
				\mode<beamer>{%
					\animategraphics[autoplay,loop,width=\paperwidth,every=\everyframe]{24}{./movies/tooth045/full-slices/image0}{000}{466}%
					}%
				\mode<handout>{%
					\includegraphics[width=\paperwidth]{./movies/tooth045/full-slices/image0000}%
					}%
				}%
			};%
	\end{tikzpicture}%
\end{frame}

\begin{frame}
	\frametitle{Detection of enamel-dentin border}
	\centering
	\only<1|handout:1>{%
		\includegraphics[height=\imageheight]{./images/zmk/tooth045/Tooth045.ExtractedSlices.png}%
		}%
	\only<2|handout:2>{%
		\includegraphics[width=\linewidth]{./images/zmk/tooth045/Tooth045.Briseno.png}%
		}%
\end{frame}

\begin{frame}[shrink=20]
	\frametitle{Outcome root canal configuration classification}%
	\centering%
	\begin{table}[]%
		\only<1>{%
		\begin{tabular}{llcSS}%
			\toprule%
			\multicolumn{2}{c}{Roots} & RCC & \# & \%\\%
			\midrule%
			\multicolumn{2}{c}{\multirow{9}{*}{Single (N=98)}}				& 1-1-1/1 & 73 & 74.5\\%
			\multicolumn{2}{l}{}																			& 1-1-1/2 & 14 & 14.3\\%
			\multicolumn{2}{l}{}																			& 1-1-1/3 & 1 & 1.0\\%
			\multicolumn{2}{l}{}																			& 1-1-1/4 & 2 & 2.1\\%
			\multicolumn{2}{l}{}																			& 1-1-2/1 & 1 & 1.0\\%
			\multicolumn{2}{l}{}																			& 1-2-1/1 & 4 & 4.1\\%
			\multicolumn{2}{l}{}																			& 1-2-1/2 & 1 & 1.0\\%
			\multicolumn{2}{l}{}																			& 1-2-2/2 & 1 & 1.0\\%
			\multicolumn{2}{l}{}																			& 2-3-1/1 & 1 & 1.0\\%
			\midrule%
			\multirow{4}{*}{Double (N=3)}	& \multirow{2}{*}{Buccal}		& 1-1-1/1 & 2 & 66.6\\%
																		&														& 1-2-1/1 & 1 & 33.3\\%
																		& \multirow{2}{*}{Lingual}	& 1-1-1/1 & 2 & 66.6\\%
																		&														& 1-1-1/2 & 1 & 33.3\\%
			\bottomrule%
		\end{tabular}%
		}%
		\only<2|handout:0>{%
		\begin{tabular}{llcSS}%
			\toprule%
			\multicolumn{2}{c}{Roots} & RCC & \# & \%\\%
			\midrule%
			\rowcolor{ubRed!61.8}\multicolumn{2}{c}{\multirow{9}{*}{Single (N=98)}}	& 1-1-1/1 & 73 & 74.5\\%
			\rowcolor{ubRed!61.8}\multicolumn{2}{l}{}																& 1-1-1/2 & 14 & 14.3\\%
			\multicolumn{2}{l}{}																										& 1-1-1/3 & 1 & 1.0\\%
			\rowcolor{ubRed!61.8}\multicolumn{2}{l}{}																& 1-1-1/4 & 2 & 2.1\\%
			\multicolumn{2}{l}{}																										& 1-1-2/1 & 1 & 1.0\\%
			\rowcolor{ubRed!61.8}\multicolumn{2}{l}{}																& 1-2-1/1 & 4 & 4.1\\%
			\multicolumn{2}{l}{}																										& 1-2-1/2 & 1 & 1.0\\%
			\multicolumn{2}{l}{}																										& 1-2-2/2 & 1 & 1.0\\%
			\multicolumn{2}{l}{}																										& 2-3-1/1 & 1 & 1.0\\%
			\midrule%
			\multirow{4}{*}{Double (N=3)} & \multirow{2}{*}{Buccal}									& 1-1-1/1 & 2 & 66.6\\%
																		&																					& 1-2-1/1 & 1 & 33.3\\%
																		& \multirow{2}{*}{Lingual}								& 1-1-1/1 & 2 & 66.6\\%
																		&																					& 1-1-1/2 & 1 & 33.3\\%
			\bottomrule%
		\end{tabular}%
		}%
	\end{table}%
\end{frame}%

\begin{frame}
	\frametitle{Extraction of root canal space}
	\begin{tikzpicture}[remember picture,overlay]%
	\node at (current page.center) [shift={(0,-25pt)}]{%
		\only<1|handout:0>{%
			\mode<beamer>{%
				\animategraphics[autoplay,loop,width=\paperwidth,every=\everyframe]{24}{./movies/tooth045/transparent-slices/image0}{000}{473}%
				}%
			\mode<handout>{%
				\includegraphics[width=\paperwidth]{./movies/tooth045/transparent-slices/image0000}%
				}%
			}%
		\only<2|handout:1>{%
			\mode<beamer>{%
				\animategraphics[autoplay,loop,width=\paperwidth,every=\everyframe]{24}{./movies/tooth045/transparent-slices-rcs/image0}{000}{457}%
				}%
			\mode<handout>{%
				\includegraphics[width=\paperwidth]{./movies/tooth045/transparent-slices-rcs/image0000}%
				}%
			}%
		\only<3|handout:0>{%
			\mode<beamer>{%
				\animategraphics[autoplay,loop,width=\paperwidth,every=\everyframe]{24}{./movies/tooth045/rcs/image0}{000}{413}%
				}%
			\mode<handout>{%
				\includegraphics[width=\paperwidth]{./movies/tooth045/rcs/image0000}%
				}%
			}%
		};%
	\end{tikzpicture}%
\end{frame}

\begin{frame}
	\renewcommand{\imageheight}{0.618\paperheight}%
	\frametitle{Results of root canal space extraction}%
		\includegraphics[height=\imageheight]{./images/zmk/rcs/Tooth0452}%
		\includegraphics[height=\imageheight]{./images/zmk/rcs/Tooth0278}%
		\includegraphics[height=\imageheight]{./images/zmk/rcs/Tooth0353}%
		\includegraphics[height=\imageheight]{./images/zmk/rcs/Tooth0419}%
		\includegraphics[height=\imageheight]{./images/zmk/rcs/Tooth0642}%
		\includegraphics[height=\imageheight]{./images/zmk/rcs/Tooth0752}%
		% Measuring the tooth length on Tooth093_rec_spr.bmp gives us 2092 pixels. We scanned at 10um.
		% "python ~/P/Dev/latex/draw_a_scalebar.py -i Tooth0931.png -l 2092 -p 10" gives us a scale bar
		\renewcommand{\imagewidth}{0.14\linewidth}% 720/2008
		\pgfmathsetlength{\imagescale}{\imagewidth/720}%
		\def\x{72}% scalebar-x starting at golden ratio of image width of 720px = 445
		\def\y{1807}% scalebar-y at 90% of image height of 2008px = 1807
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
				\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./images/zmk/rcs/Tooth0931}};
				% 1760.469px = 20.92mm -> 100px = 1188.319um -> 42.076px = 500um, 8.415px = 100um
				%\draw[|-|,blue,thick] (300,105) -- (327,1865) node [sloped,midway,above,fill=white,semitransparent,text opacity=1] {\qty{20.92}{\milli\meter} (1760px) TEMPORARY!};
				\draw[|-|,white,shadowed] (\x,\y) -- (\x+420.76,\y) node [midway,above] {\shadowtext{\qty{5}{\milli\meter}}};
		\end{tikzpicture}%
\end{frame}

\begin{frame}
	\frametitle{Analysis of the physiological foramen geometry}
	\centering
	\only<1|handout:1>{%
		\includegraphics[height=\imageheight]{./images/zmk/foramen}%
		\sourcecite{Wolf2017}{Fig.~1}%
		}%
	\only<2|handout:0>{%
		\mode<beamer>{%
			\animategraphics[palindrome,autoplay,height=\imageheight,every=\everyframe]{24}{./movies/tooth045/edt-axial/Tooth045_EDT_Axial_}{100}{199}%
			}%
		\mode<handout>{%
			\includegraphics[height=\imageheight]{./movies/tooth045/edt-axial/Tooth045_EDT_Axial_151}%
			}%
		}%
	\only<3|handout:2>{%
		\mode<beamer>{%
			\animategraphics[palindrome,autoplay,height=\imageheight,every=\everyframe]{24}{./movies/tooth045/edt-coronal/Tooth045_EDT_Coronal_}{123}{213}%
			}%
		\mode<handout>{%
			\includegraphics[height=\imageheight]{./movies/tooth045/edt-coronal/Tooth045_EDT_Coronal_139}%
			}%
		}%
\end{frame}

\begin{frame}
	\frametitle{Conclusion ZMK}
	\begin{itemize}
		\item Efficient use of time, \eg more teeth does not mean more (human) work
		\item Reproducible analysis with \emph{free and open-source} software, usable by \emph{anyone}
		\item Objective analysis, \eg no operator bias
	\end{itemize}
\end{frame}

\subsection{Metal foam analysis}
\renewcommand{\imagewidth}{0.55\linewidth}%
\begin{frame}
	\frametitle{Metal foam}
	\centering
	\pgfmathsetlength{\imagescale}{\imagewidth/800}%
	\def\x{494}% scalebar-x starting at golden ratio of image width of 800px = 494
	\def\y{540}% scalebar-y at 90% of image height of 600px = 540
	\only<1|handout:1>{
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{./movies/metal_foam/HART_0.4um_Al0.25mm_180_rec_frames/HART_0.4um_Al0.25mm_180_rec0000}};
			% 665.634px = 1.221973872mm -> 100px = 183.580um -> 272.360px = 500um, 54.472px = 100um
			%\draw[|-|,blue,thick] (67,245) -- (732,237) node [sloped,midway,above,fill=white,semitransparent,text opacity=1] {\qty{1.221973872}{\milli\meter} (666px) TEMPORARY!};
			\draw[|-|,white,shadowed] (\x,\y) -- (\x+272.360,\y) node [midway,above] {\shadowtext{\qty{500}{\micro\meter}}};
			\end{tikzpicture}%
			}%
	\only<2|handout:0>{
		\animategraphics[autoplay,width=\imagewidth,every=\everyframe]{24}{./movies/metal_foam/HART_0.4um_Al0.25mm_180_rec_frames/HART_0.4um_Al0.25mm_180_rec0}{000}{134}%
	}%
	\only<3|handout:0>{
		\animategraphics[autoplay,width=\imagewidth,every=\everyframe]{24}{./movies/metal_foam/HART_0.4um_Al0.25mm_180_rec_frames/HART_0.4um_Al0.25mm_180_rec0}{135}{155}%
	}%
	\only<4|handout:0>{
		\animategraphics[autoplay,width=\imagewidth,every=\everyframe]{24}{./movies/metal_foam/HART_0.4um_Al0.25mm_180_rec_frames/HART_0.4um_Al0.25mm_180_rec0}{156}{239}%
	}%
	\source{Etienne Berner}{NanoElectroCatalysis Group}
\end{frame}

\begin{frame}
	\frametitle{Thanks!}
	\begin{itemize}
		\item Thanks for listening to me!
		\item<2-> \href{https://twitter.com/jackiantonovich/status/1195699076056178691}{What questions do you have for me?}
	\end{itemize}
	\only<3|handout:0>{%
		\begin{tikzpicture}[remember picture,overlay]%
			\node at (current page.center){%
				\animategraphics[loop,autoplay,width=\paperwidth,every=\everyframe]{24}{./movies/mouse_skull/mouse_skull}{000}{236}%
				};%
		\end{tikzpicture}%
	}%
\end{frame}

\begin{frame}
	\frametitle{\href{https://en.wikipedia.org/wiki/Colophon_(publishing)}{Colophon}}
	\begin{itemize}
		\item This \textsc{beamer} presentation was crafted in \LaTeX\xspace with the (slightly adapted) \href{http://intern.unibe.ch/dienstleistungen/corporate_design_und_vorlagen/praesentationen/index_ger.html}{template from \emph{Corporate Design und Vorlagen} of the University of Bern}.
		\begin{itemize}
			\item \href{https://github.com/habi/lecture.microtomography/}{Complete source code: git.io/fjpP7}
			\item The \LaTeX\xspace code is automatically compiled with a \href{https://github.com/actions}{GitHub action}\footnote{Details on how this works are specified in a \href{https://github.com/habi/latex-test/}{small test repository here: git.io/JeOOj}} to a \href{https://habi.github.io/Lecture.Microtomography/XRayMicroTomography.Handout.pdf}{(handout) PDF which you can access here: git.io/JeQxO}
		\end{itemize}
		\item Did you spot an error?
		\begin{itemize}
			\item \href{https://github.com/habi/lecture.microtomography/issues}{File an issue: git.io/fjpPb}
			\item \href{https://github.com/habi/lecture.microtomography/pulls}{Submit a pull request: git.io/fjpPN}
			\item \href{mailto:david.haberthuer@unibe.ch?subject=Error\%20in\%20the\%20(micro)-tomography\%20lecture\&body=https://xkcd.com/386/}{Send me an email: david.haberthuer@unibe.ch}
		\end{itemize}
	\end{itemize}
\end{frame}

\begin{frame}[allowframebreaks]
	\frametitle{References}
	\renewcommand*{\bibfont}{\scriptsize}
	\setbeamertemplate{bibliography item}{\insertbiblabel}
	\printbibliography
\end{frame}

\end{document}
